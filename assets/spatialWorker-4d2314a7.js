(function(){"use strict";let b,v,d;const P=(e,r,i,u)=>{const h=r-e;if(!h)return[];const l=Math.floor(Math.log10(u*h/i)),c=[1,2,5].map(f=>f*Math.pow(10,l)),g=c.map(f=>Math.abs(f-u*h/i)),t=g.indexOf(Math.min(...g)),y=c[t],m=Math.ceil(e/y),M=Math.floor(r/y),x=[];for(let f=m;f<=M;f++){const N=f*y;x.push({value:N,major:!1})}return x};onmessage=function(e){e.data.canvas&&(b=e.data.canvas,S()),e.data.opts&&(v=e.data.opts,S()),e.data.dataSeries&&(d=e.data.dataSeries,S())};function w(e,r){let i=!1;return()=>{i||(i=!0,setTimeout(()=>{i=!1,e()},r))}}async function A(){if(!b||!v||!d)return;const{margins:e,canvasWidth:r,canvasHeight:i,visibleStartTimeSec:u,visibleEndTimeSec:h,xMin:l,xMax:p,yMin:c,yMax:g}=v;b.width=r,b.height=i;const t=b.getContext("2d");if(!t)return;t.clearRect(0,0,r,i);const y=Math.min((r-e.left-e.right)/(p-l),(i-e.top-e.bottom)/(g-c)),m=(r-e.left-e.right-(p-l)*y)/2,M=(i-e.top-e.bottom-(g-c)*y)/2,x=n=>({x:isNaN(n.x)?NaN:e.left+m+(n.x-l)*y,y:isNaN(n.y)?NaN:i-e.bottom-M-(n.y-c)*y}),f=n=>{const s=n.toFixed(10),a=s.indexOf(".");if(a<0)return s;let o=s.length-1;for(;o>a&&s[o]==="0";)o--;return s[o]==="."&&o--,s.slice(0,o+1)},N=P(l,p,r-e.left-e.right,180);(()=>{const n=x({x:l,y:c}),s=x({x:p,y:c});t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(s.x,s.y),t.strokeStyle="rgb(0,0,0)",t.stroke();for(const a of N){const o=x({x:a.value,y:c});t.beginPath(),t.moveTo(o.x,o.y),t.lineTo(o.x,o.y+5),t.strokeStyle="rgb(0,0,0)",t.stroke(),t.font="12px sans-serif",t.fillStyle="rgb(0,0,0)",t.textAlign="center",t.textBaseline="top",t.fillText(f(a.value),o.x,o.y+7)}})();const C=P(c,g,i-e.top-e.bottom,80);(()=>{const n=x({x:l,y:c}),s=x({x:l,y:g});t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(s.x,s.y),t.strokeStyle="rgb(0,0,0)",t.stroke();for(const a of C){const o=x({x:l,y:a.value});t.beginPath(),t.moveTo(o.x,o.y),t.lineTo(o.x-5,o.y),t.strokeStyle="rgb(0,0,0)",t.stroke(),t.font="12px sans-serif",t.fillStyle="rgb(0,0,0)",t.textAlign="right",t.textBaseline="middle",t.fillText(f(a.value),o.x-7,o.y)}})();const z=n=>{const s=(n-u)/(h-u),a=0,o=Math.floor(255*(1-s)),k=Math.floor(255*s);return`rgb(${a},${o},${k})`};let T;for(let n=0;n<d.t.length;n++){const s=d.t[n];if(s<u||s>h)continue;const a=d.x[n],o=d.y[n];if(isNaN(a)||isNaN(o))T=void 0;else{const k=x({x:d.x[n],y:d.y[n]});T&&(t.beginPath(),t.moveTo(T.x,T.y),t.lineTo(k.x,k.y),t.strokeStyle=z(s),t.stroke()),T=k}}}const S=w(A,10)})();
